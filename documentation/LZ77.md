# LZ77.cpp Documentation

## Overview
`LZ77.cpp` implements a simple LZ77-style dictionary compressor used as a pre-processing stage for the hybrid `HUF_LZ77` format. It converts raw bytes into a sequence of `(offset, length, next)` tokens and back.

## Token Structure
Each `LZ77::Token` consists of:
- `offset` (`uint16_t`): how many bytes back from the current position to start copying.
- `length` (`uint16_t`): how many bytes to copy from the match.
- `next` (`uint8_t`): the literal byte that follows the matched sequence.

## Compression Algorithm
- `std::vector<LZ77::Token> LZ77::compress(const std::vector<uint8_t>& data, size_t window, size_t lookahead)`:
  - Iterates through `data` from left to right with an index `pos`.
  - For each position:
    - Searches backward within a window of at most `window` bytes for the longest match of up to `lookahead` bytes.
    - Records `best_offset` and `best_length` if a longer match is found.
    - Determines `next` as the byte following the match (or 0 if at the end).
    - Emits a `Token{best_offset, best_length, next}`.
    - Advances `pos` by `best_length + 1`.
  - Complexity is O(window Ã— lookahead) per position in the naive implementation.

## Decompression Algorithm
- `std::vector<uint8_t> LZ77::decompress(const std::vector<Token>& tokens)`:
  - Maintains an output buffer `out`.
  - For each token:
    - Computes `start = out.size() - offset` (with underflow protection).
    - Copies `length` bytes from `out[start + i]` back into the end of `out`.
    - Appends the `next` literal byte.
  - Reconstructs the original stream as long as tokens were produced by the compressor with valid offsets.

## Token Serialization
- `std::vector<uint8_t> LZ77::tokensToBytes(const std::vector<Token>& tokens)`:
  - Serializes each token as 5 bytes:
    - `offset` high byte, `offset` low byte.
    - `length` high byte, `length` low byte.
    - `next` byte.
  - Produces a flat `std::vector<uint8_t>` suitable for Huffman coding.
- `std::vector<LZ77::Token> LZ77::bytesToTokens(const std::vector<uint8_t>& bytes)`:
  - Parses the 5-byte structure repeatedly until fewer than 5 bytes remain.
  - Reconstructs `offset`, `length`, `next` and returns the token vector.

## Usage in the Project
- `Compressor::compressInternal` uses `LZ77::compress` and `tokensToBytes` before Huffman coding to improve compression on repetitive data.
- `Decompressor` uses `bytesToTokens` and `LZ77::decompress` when decoding `HUF_LZ77` streams.
